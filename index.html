<!DOCTYPE html>
<html lang="en" class="no-js">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Solid Template</title>
    <link href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:400,600" rel="stylesheet">
    <link rel="stylesheet" href="https://stackedit.io/style.css" />
    <link rel="stylesheet" href="dist/css/style.css">

    <script src="https://unpkg.com/animejs@3.0.1/lib/anime.min.js"></script>
    <script src="https://unpkg.com/scrollreveal@4.0.0/dist/scrollreveal.min.js"></script>
</head>

<body class="is-boxed has-animations">
    <div class="body-wrap">
        <header class="site-header">
            <div class="container">
                <div class="site-header-inner">
                    <div class="brand header-brand">
                        <h1 class="m-0">
                            <a href="#">
                                <img class="header-logo-image" src="dist/images/logo.svg" alt="Logo">
                            </a>
                        </h1>
                    </div>
                </div>
            </div>
        </header>

        <main>
            <section class="hero">
                <div class="container">
                    <div class="hero-inner">
                        <div class="hero-copy">
                            <h1 class="hero-title mt-0">You're getting attacked by the <s>NSA</s> Kilyan Le Gallic</h1>

                            <p class="hero-paragraph">Thanks to my very deep understanding of networks, I have setup a stub network, similar to one you can find in a bussiness</p>
                            <div class="hero-cta"><a class="button button-primary" href="#">A button</a><a class="button" href="#">Yet another button</a></div>
                        </div>
                        <div class="hero-figure anime-element">
                            <svg class="placeholder" width="528" height="396" viewBox="0 0 528 396">
								<rect width="528" height="396" style="fill:transparent;" />
							</svg>
                            <div class="hero-figure-box hero-figure-box-01" data-rotation="45deg"></div>
                            <div class="hero-figure-box hero-figure-box-02" data-rotation="-45deg"></div>
                            <div class="hero-figure-box hero-figure-box-03" data-rotation="0deg"></div>
                            <div class="hero-figure-box hero-figure-box-04" data-rotation="-135deg"></div>
                            <div class="hero-figure-box hero-figure-box-05"></div>
                            <div class="hero-figure-box hero-figure-box-06"></div>
                            <div class="hero-figure-box hero-figure-box-07"></div>
                            <div class="hero-figure-box hero-figure-box-08" data-rotation="-22deg"></div>
                            <div class="hero-figure-box hero-figure-box-09" data-rotation="-52deg"></div>
                            <div class="hero-figure-box hero-figure-box-10" data-rotation="-50deg"></div>

                        </div>
                    </div>
                </div>
            </section>

            <section class="features section">
                <div class="container">
                    <div class="features-inner section-inner has-bottom-divider">
                        <div class="features-wrap">
                            <div class="feature text-center is-revealing">
                                <div class="feature-inner">
                                    <div class="feature-icon">
                                        <img src="dist/images/feature-icon-01.svg" alt="Feature 01">
                                    </div>
                                    <h4 class="feature-title mt-24">You're reading this</h4>
                                    <p class="text-sm mb-0">And now, this</p>
                                </div>
                            </div>
                            <div class="feature text-center is-revealing">
                                <div class="feature-inner">
                                    <div class="feature-icon">
                                        <img src="dist/images/Loth_Livre_III.svg" width="120" height="200" alt="Feature 02">
                                    </div>
                                    <h4 class="feature-title mt-24">"Tempora mori, tempora mundis recorda."" </h4>
                                    <p class="text-sm mb-0">"Voil√†. Eh bien √ßa, par exemple, √ßa veut absolument rien dire, mais l‚Äôeffet reste le m√™me, et pourtant j‚Äôai jamais foutu les pieds dans une salle de classe attention !"</p>
                                    <q>Le roi Loth</q>
                                </div>
                            </div>
                            <div class="feature text-center is-revealing">
                                <div class="feature-inner">
                                    <div class="feature-icon">
                                        <img width="120" height="100" src="dist/images/sillius_flag_of_britain.svg" alt="Feature 02">
                                    </div>
                                    <h4 class="feature-title mt-24">Et voici venir le temps des poings lev√©s !</h4>
                                    <q>Gilles Servat</q>
                                    <p class="text-sm mb-0"> "Air de Bignou"</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="stackedit" style="color : white;">
                <div>
                    <div class="stackedit__html">
                        <h1 id="mise-en-place-d‚Äôun-r√©seau-d‚Äôentreprise">Mise en place d‚Äôun r√©seau d‚Äôentreprise</h1>
                        <h2 id="introduction">Introduction</h2>
                        <p>L‚Äôobjectif de ce projet est de disposer d‚Äôune √©bauche de r√©seau tel qu‚Äôon pourrait trouver dans une entreprise, avec une DMZ contenant un serveur proposant plusieurs services (pour l‚Äôinstant juste une instance apache2) et un r√©seau
                            priv√© contenant les machines clientes de l‚Äôentreprise.</p>
                        <p>La totalit√© du r√©seau tourne sur des VMs Debian Bullseye 11.1/Ubuntu 20.04 virtualis√©es sur VirtualBox.<br> Ce projet a √©t√© r√©alis√© en collaboration avec :</p>
                        <ul>
                            <li>Emrick Pesce</li>
                            <li>Fabien Borys</li>
                            <li>Paul Durieux</li>
                            <li>Etienne Cotte</li>
                        </ul>
                        <h2 id="sommaire">Sommaire</h2>
                        <ul>
                            <li><a href="#d%C3%A9tails">D√©tails des outils utilis√©s</a></li>
                            <li><a href="#plan_d'adressage">Plan d‚Äôadressage</a></li>
                            <li><a href="#">Interconnexion de la DMZ et du r√©seau priv√©</a></li>
                            <li><a href="#">Interconnexion avec un r√©seau identique g√©r√© par une autre personne</a></li>
                            <li><a href="#">Connexion des r√©seaux priv√©s √† Internet via le routeur</a></li>
                            <li><a href="#">Mise en place d‚Äôune politique de s√©curit√©</a></li>
                            <li><a href="#dhcp">DHCP</a></li>
                            <li><a href="#proxy">Proxy</a></li>
                            <li><a href="#dns">DNS</a></li>
                        </ul>
                        <h2 id="d√©tails-des-outils-utilis√©s">D√©tails des outils utilis√©s</h2>
                        <ul>
                            <li><a href="#apache2">Serveur Web : apache2</a></li>
                            <li>Navigateur web : Firefox</li>
                            <li><a href="#squid">Proxy : squid</a></li>
                            <li><a href="#dhcp">Serveur DHCP : isc-dhcp-server</a></li>
                            <li><a href="#dns">DNS : bind</a></li>
                        </ul>
                        <h2 id="plan-d‚Äôadressage">Plan d‚Äôadressage</h2>
                        <p>Le serveur est situ√© sur le sous-r√©seau <strong>DMZ</strong> <em><strong>192.168.1.0/24</strong></em> (adresse IP fix√© √† XXX.1.1 via la configuration DHCP)<br> Les clients sont situ√©s sur le sous-r√©seau <strong>private</strong>                            <em><strong>192.168.2.0/24</strong></em><br> Le routeur fera office de serveur DHCP, de proxy et de serveur DNS. Ses adresses sont
                            <em><strong>192.168.1.1</strong></em> (private) et <em><strong>192.168.2.1</strong></em> (DMZ). Son adresse publique est <em><strong>10.10.2.16</strong></em> (<em>g√©r√©e par VirtualBox via une connexion NAT</em>)</p>
                        <p><img src="./dist/images/diagram.png" alt=""></p>
                        <h2 id="apache2">apache2</h2>
                        <p>Afin de pouvoir tester la communication client - serveur, il a √©t√© d√©cid√© de mettre en place un serveur apache2 heberg√© sur le serveur et proposant un site web.<br> La configuration est celle par d√©faut, le besoin de disposer de
                            plusieurs serveurs en parall√®le ne s‚Äôexprimant pas.
                        </p>
                        <h2 id="interconnexion-de-la-dmz-et-du-r√©seau-priv√©">Interconnexion de la DMZ et du r√©seau priv√©</h2>
                        <p>Pour que le client puisse acc√©der au serveur, il faut mettre en place le routage.<br> Pour ce faire, il faut premi√®rement indiquer √† la machine routeur de <em>forward</em> les paquets.</p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@routeur:~$</span>	 <span class="token keyword">echo</span> 1 <span class="token operator">&gt;</span> /proc/sys/net/ipv4/ip_forward
                  
                  </code></pre>
                        <p>Il faut ensuite fournir aux machines clientes et serveur la route √† suivre pour acc√©der l‚Äôune √† l‚Äôautre.</p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@client:~$</span>	 ip route add 192.168.1.2/24 via 192.168.1.1
                  
                  </code></pre>
                        <p>Mais la configuration la plus intelligente des routes est de d√©finir le routeur comme √©tant la route par d√©faut des machines.</p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@client:~$</span>	 ip route add default via 192.168.1.1
                  
                  </code></pre>
                        <p>D√©sormais, un client peut acc√©der √† la page web h√©berg√© par le serveur.<br> Il n‚Äôy a pas besoin de mettre en place du NAT car les √©changes sont rout√©s entre deux r√©seaux priv√©s (192.168.X.X) et ne seront pas rejet√©s par le routeur.</p>
                        <h2 id="interconnexion-avec-un-r√©seau-identique-g√©r√©-par-une-autre-personne">Interconnexion avec un r√©seau identique g√©r√© par une autre personne</h2>
                        <p>Cette partie a √©t√© r√©alis√©e avec l‚Äôaimable collaboration de M. Emrick PESCE.<br> Le r√©seau g√©r√© par Emrick est identique au mien (au plan d‚Äôadressage pr√®s).</p>
                        <h3 id="mise-en-place-du-dnat">Mise en place du DNAT</h3>
                        <p>Afin de pouvoir requ√™ter le serveur d‚ÄôEmrick, il faut que mon client connaisse ait acc√®s √† son serveur.<br> Or la configuration actuelle de nos routeurs rend cela impossible, car le client A a tout au plus acc√®s au routeur B.
                            <br> Il faut donc indiquer au routeur que toute requ√™te sur le port 80 (web) afin de rediriger vers le serveur. Cela est totalement transparent pour le client.</p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@client:~$</span>	 iptables -t nat -A PREROUTING -d 10.10.20.4 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.2:80
                  
                  </code></pre>
                        <h3 id="branchement-au-switch">Branchement au switch</h3>
                        <p>Grace √† la contribution de Mme Ana√Øs THILLAYE üî•, nous disposons d‚Äôun switch (Cisco?) sur lequel nous pouvons brancher nos deux machines h√¥tes en Ethernet en ajoutant une connexion <strong>par pont</strong> sur nos routeurs.
                        </p>
                        <p><img src="./dist/images/test-2021-12-07_13.32.40.gif" alt=""></p>
                        <h2 id="connexion-des-r√©seaux-priv√©s-√†-internet-via-le-routeur">Connexion des r√©seaux priv√©s √† Internet via le routeur
                        </h2>
                        <p>Pour l‚Äôinstant, les machines clientes et serveurs sont connect√©es √† Internet via une interface NAT dans le souci de pouvoir installer des paquets tels que apache2 ou curl.<br> Mais cette configuration n‚Äôoffre presque aucun contr√¥le
                            de l‚Äôentreprise sur le trafic des machines clientes (ils peuvent par exemple acc√©der √† des sites potentiellement infect√©s).<br> Il faut donc faire en sorte que le trafic sortant du r√©seau priv√© soit oblig√© de transiter via
                            le routeur.<br> Or, le routeur ne peut ‚Äú<em>forward</em>‚Äù le trafic provenant du r√©seau priv√© sur Internet car les paquets provenant d‚Äôadresses priv√©es doivent √™tre rejet√©s par les routeurs n‚Äôayant pas de connexion directe
                            dans ce r√©seau. Les paquets seraient alors directement drop par le prochain routeur.<br> Afin de pouvoir faire en sorte que les clients puissent communiquer sur Internet via le routeur, il faut mettre en place du <strong>Source Nating</strong>                            (<em><strong>SNAT</strong></em>).</p>
                        <p>Pour ce faire, il faut d‚Äôabord indiquer au routeur qu‚Äôil peut remplacer les adresses IPs sources par la sienne.
                        </p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@routeur:~$</span>	 iptables -t nat -A POSTROUTING -o enp0s10 -j MASQUERADE
                  
                  </code></pre>
                        <p>Il faut ensuite ensuite indiquer au routeur quelles adresses IP il peut remplacer.</p>
                        <pre class=" language-bash"><code class="prism  language-bash"><span class="identifier-user">root@routeur:~$</span>	 iptables -t nat -A POSTROUTING -o enp0s10 -j SNAT --to 10.0.2.55
                  
                  </code></pre>
                        <p>Les machines clientes ont maintenant acc√®s √† Internet via le routeur.</p>
                        <h2 id="dhcp">DHCP</h2>
                        <h3 id="configuration-du-serveur-dhcp">Configuration du serveur DHCP</h3>
                        <p>Afin d‚Äô√©viter la configuration manuelle des machines clientes, il faut fournir un service DHCP (<em>Dynamic Host
                          Configuration Protocol</em>).<br> L‚Äôoutil choisi pour effectuer ceci est <strong>isc-dhcp-server</strong>, qui remplace dhcp3-server.</p>
                        <p>Le serveur DNS choisi est le DNS de Cloudflare (1.1.1.1 / 1.0.0.1).</p>
                        <p>Il faut d√©clarer dans le fichier <strong>/etc/dhcp/dhcpd.conf</strong> la configuration suivante :</p>
                        <pre><code>subnet 192.168.2.0 netmask 255.255.255.0 {
                      range 192.168.2.2 192.168.2.30; #Plages d'adresses pouvant √™tre donn√©es √† un client
                      options routers 192.168.1.1; #Route par d√©faut pointant sur le routeur
                  }
                  
                  </code></pre>
                        <p>Pour donner une adresse constante au serveur, on peut l‚Äôindentifier via son adresse MAC :</p>
                        <pre><code>host server {
                      hardware ethernet 08:00:27:13:70:bb; #Adresse MAC de l'interface du serveur
                      fixed-adress 192.168.1.2;
                  
                  </code></pre>
                        <p>Il faut √©galement indiquer √† isc-dhcp-server quelles interfaces il doit √©couter.<br> Il faut pour cela modifier le fichier <strong>/etc/default/isc-dhcp-server</strong> en rajoutant les interfaces √† √©couter (par d√©faut, l‚Äôinterface
                            √©cout√©e est eth0) :</p>
                        <pre><code>INTERFACES="enp0s8 enp0s9"
                  </code></pre>
                        <h3 id="configuration-des-clients">Configuration des clients</h3>
                        <p>Pour que les machines clientes puissent demander et recevoir des adresses via le serveur DHCP, il faut modifier la configuration de leur interface :</p>
                        <p>Fichier de configuration <strong>/etc/network/interfaces</strong> :</p>
                        <pre><code>iface enp0s8 inet dhcp
                  </code></pre>
                        <h2 id="proxy">Proxy</h2>
                        <h3 id="proxy-cache-classique">Proxy cache classique</h3>
                        <h4 id="configuration-du-proxy">Configuration du proxy</h4>
                        <p>Afin de pouvoir √©viter une surcharge inutile du r√©seau si plusieurs clients souhaitent acc√©der √† la m√™me ressource (la bande passante externe est bien plus co√ªteuse que la bande passante interne), on peut mettre en place un proxy.<br>                            L‚Äôoutil utilis√© est squid, un proxy cache http/https/ftp combin√© √† un acc√©l√©rateur web (ressource compressor).<br> Squid est heberg√© sur le routeur, et est configur√© de tel sorte qu‚Äôil n‚Äôautorise pas le protocole SSH ni l‚Äôacc√®s
                            au site internet <a href="http://facebook.com">facebook.com</a> .<br> Fichier de configuration <strong>/etc/squid/squid.conf</strong> :</p>
                        <pre><code> http_port 3128 #Configuration par d√©faut du port
                   acl localnet src 192.168.2.0.24 #private network
                   acl SSH port 22
                   acl Safe port 80
                   acl Safe port 443
                   acl Safe port 21
                   acl Facebook dstdomain dstdomain .facebook.com
                   //////
                   http_access deny SSH
                   http_deny !Safe
                   http_deny Facebook
                  
                  </code></pre>
                        <h4 id="configuration-du-navigateur">Configuration du navigateur</h4>
                        <p>Pour que le navigateur utilise le proxy, il faut lui indiquer qu‚Äôil doit passer par un proxy :<br>
                            <img src="https://www.numelion.com/wp-content/uploads/2017/08/parametrer-proxy-mozilla-firefox.jpg" alt="enter image description here">
                        </p>
                        <h3 id="proxy-transparent">Proxy transparent</h3>
                        <p>Afin de faciliter l‚Äôacc√®s √† Internet des machines clientes, on peut indiquer au routeur qu‚Äôil doit rediriger tout le trafic http sur le proxy afin que le client n‚Äôai pas √† configurer son proxy.<br> Il s‚Äôagit d‚Äôune simple redirection
                            des ports 80 (HTTP) et 443 (HTTPS) :</p>
                        <pre class=" language-bash"><code class="prism  language-bash">
<span><span class="identifier-user">root@routeur:~$</span>iptables -t nat -A PREROUTING -i enp0s8 -p tcp --dport 80 -j REDIRECT --to-port 3128</span>
                  
<span><span class="identifier-user">root@routeur:~$</span> iptables -t nat -A PREROUTING -i enp0s8 -p tcp --dport 443 -j REDIRECT --to-port 3129</span>
                  
                  </code></pre>
                        <p>A noter que Squid est configur√© pour disposer de 2 ports qui prennent respectivement en charge HTTP (port 80) et HTTPS (port 443)</p>
                        <p>Ceci dans le but de ne pas essayer d'envoyer une requ√™te HTTPS sur le port HTTP, ce qui mettrait en √©chec le proxy</p>
                        <p>D√©sormais, les machines clientes n‚Äôont plus √† configurer leur navigateur pour utiliser le proxy.</p>
                        <h2 id="dns">DNS</h2>
                        <p>L‚Äôoutil choisi pour r√©aliser le serveur DNS est <strong>bind9</strong>.<br> Pour cr√©er un nom de domaine, il faut cr√©er un nouveau fichier db.nom_de_zone dans le r√©pertoir <strong>/etc/bind/</strong> du serveur.<br> J‚Äôai fait le
                            choix de cr√©er un nom de domaine correspondant √† ma DMZ, mydmz.lan.<br> Fichier de configuration <strong>db.mydmz.lan</strong>:</p>
                        <pre><code>$TTL    604800
@       IN      SOA     mydmz.lan. webmaster.mail.net. (
                              1         ; Serial
                         604800         ; Refresh
                          86400         ; Retry
                        2419200         ; Expire
                         604800 )       ; Negative 
@       IN      NS      mydmz.lan.
NS      IN      A       192.168.1.2
box     IN      AAAA		::
</code></pre>
                        <p>Il faut ensuite d√©clarer la zone dans le fichier <strong>/etc/bind/named.conf.local</strong> de configuration local de bind9 :</p>
                        <pre><code>zone "mydmz.lan" {
	type master;
	file "/etc/bind/db.mydmz.lan";
}
</code></pre>
                        <p>On peut maintenant relancer le service named (alias√© par bind9) et tenter d‚Äôacc√©der au nom de domaine.<br> Le r√©sultat d‚Äôun commande dig sur le nom de domaine retourne une r√©ponse <strong>mais</strong> provenant de 1.0.0.1, le
                            DNS pass√© en configuration par d√©faut via le DHCP.<br> Il faut donc indiquer √† notre serveur DHCP de rajouter <strong>192.168.1.2</strong> en tant que serveur DNS afin qu‚Äôil apparaise dans le <strong>/etc/resolv.conf</strong>                            des clients.<br> Une fois la modification effectu√©e, les clients peuvent requ√™ter le nom de domaine et sont dirig√©s sur la page web heberg√© sur le serveur.<br> Afin de pouvoir acc√©der aux noms de domaines mis en place par mes
                            camarades, nous avons choisi de configurer chacun de nos DNS afin de fournir aux machines clientes l‚Äôadresse √† joindre (<strong>l‚Äôadresse du routeur</strong>). Cette d√©cision a √©t√© prise en raison de contraintes horaires et
                            techniques de notre part.</p>
                    </div>
                </div>
    </div>
    </section>

    <section class="pricing section">
        <div class="container-sm">
            <div class="pricing-inner section-inner">
                <div class="pricing-header text-center">
                    <h2 class="section-title mt-0">Unlimited for all</h2>
                    <p class="section-paragraph mb-0">LALALALALALALALALALALALALALALALALALALALALALALALA</p>
                </div>
                <div class="pricing-tables-wrap">
                    <div class="pricing-table">
                        <div class="pricing-table-inner is-revealing">
                            <div class="pricing-table-main">
                                <div class="pricing-table-header pb-24">
                                    <div class="pricing-table-price"><span class="pricing-table-price-currency h2">20</span><span class="pricing-table-price-amount h1">/20</span><span class="text-xs"> right now</span></div>
                                </div>
                                <div class="pricing-table-features-title text-xs pt-24 pb-24">What you will get</div>
                                <ul class="pricing-table-features list-reset text-xs">
                                    <li>
                                        <span>Unlimited stuff</span>
                                    </li>
                                    <li>
                                        <span>DANS LA TRIBU OH OH DE DANA LALILALA</span>
                                    </li>
                                    <li>
                                        <span>${thing}</span>
                                    </li>
                                    <li>
                                        <span>Free IKEA pencils</span>
                                    </li>
                                </ul>
                            </div>
                            <div class="pricing-table-cta mb-8">
                                <a class="button button-primary button-shadow button-block" href="le-site-des-notes.com">HERe</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section class="cta section">
        <div class="container">
            <div class="cta-inner section-inner">
                <h3 class="section-title mt-0">Still not convinced</h3>
                <div class="cta-cta">
                    <a class="button button-primary button-wide-mobile" href="">Get in touch</a>
                </div>
            </div>
        </div>
    </section>
    </main>


    </div>

    <script src="dist/js/main.min.js"></script>
</body>

</html>